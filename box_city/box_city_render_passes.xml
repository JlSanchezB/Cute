<Root>
<Global>
  <Resource type="RootSignature" name="BoxRootSignature">
    <RootParam index="0" type="Constants" num_constants="1" shader_register="1" visibility="Vertex"/>
    <RootParam index="1" type="DescriptorTable" visibility="All">
      <Range base_shader_register="0" size="1" type="ConstantBuffer"/>
      <Range base_shader_register="0" size="1" type="ShaderResource"/>
      <Range base_shader_register="1" size="1" type="ShaderResource"/>
    </RootParam>
    <StaticSample shader_register="0" visibility="Pixel"/>
    <StaticSample shader_register="1" visibility="Pixel" filter="Linear"/>
  </Resource>
  <Resource type="GraphicsPipelineState" name="BoxPipelineState" depth_enable="true" depth_write="true" depth_stencil_format="D32_FLOAT" depth_func="Greater">
    <RootSignature>BoxRootSignature</RootSignature>
    <InputLayouts>
      <Input semantic_name="POSITION" semantic_index="0" format="R32G32B32_FLOAT" input_slot="0"/>
      <Input semantic_name="NORMAL" semantic_index="0" format="R32G32B32_FLOAT" input_slot="1"/>
    </InputLayouts>
    <PixelShader entry_point="ps_box_main" target="ps_6_6">box_rendering.hlsl</PixelShader>
    <VertexShader entry_point="vs_box_main" target="vs_6_6">box_rendering.hlsl</VertexShader>
    <Rasterization cull_mode="Front"/>
    <RenderTargets>
      <RenderTarget format="R8G8B8A8_UNORM"/>
    </RenderTargets>
  </Resource>
  <Resource type="RootSignature" name="BoxCullingRootSignature">
    <RootParam index="0" type="Constants" num_constants="1" shader_register="1" visibility="All"/>
    <RootParam index="1" type="DescriptorTable" visibility="All">
      <Range base_shader_register="0" size="1" type="ConstantBuffer"/>
      <Range base_shader_register="0" size="1" type="ShaderResource"/>
      <Range base_shader_register="1" size="1" type="ShaderResource"/>
      <Range base_shader_register="0" size="1" type="UnorderedAccessBuffer"/>
      <Range base_shader_register="1" size="1" type="UnorderedAccessBuffer"/>
    </RootParam>
  </Resource>
  <Resource type="ComputePipelineState" name="BoxCullingPipelineState">
    <RootSignature>BoxCullingRootSignature</RootSignature>
    <ComputeShader entry_point="box_culling" target="cs_6_6">box_culling.hlsl</ComputeShader>
  </Resource>
</Global>
<Passes>
  <Pass name="SyncStaticGPUMemory">
    <Dependencies>
      <Resource name="StaticGPUMemoryBuffer" pre_condition_state="Init" post_update_state="Ready" access="UnorderedAccess"/>
    </Dependencies>
    <Commands>
      <SyncStaticGPUMemoryPass/>
    </Commands>
  </Pass>
  <Pass name="Main">
    <Dependencies>
      <Resource name="StaticGPUMemoryBuffer" pre_condition_state="Ready" access="AllShaderResource"/>
      <DepthBuffer name="SceneDepth" pre_condition_state="Alloc" post_update_state="Free" access="Depth" format="D32_FLOAT" default_depth="0.f"/>
      <Resource name="BackBuffer" access="RenderTarget"/>
    </Dependencies>
    <Commands>
      <SetRenderTarget>
		    <RenderTarget>BackBuffer</RenderTarget>
        <DepthBuffer>SceneDepth</DepthBuffer>
	    </SetRenderTarget>
      <SetRootSignature>BoxRootSignature</SetRootSignature>
      <SetDescriptorTable pipe="Graphics" root_param="1">
        <Descriptor>ViewConstantBuffer</Descriptor>
        <Descriptor as="ShaderResource">StaticGPUMemoryBuffer</Descriptor>
        <Descriptor>DynamicGPUMemoryBuffer</Descriptor>
      </SetDescriptorTable>
	    <ClearRenderTarget colour="0,0,0,0">BackBuffer</ClearRenderTarget>
      <ClearDepthStencil>SceneDepth</ClearDepthStencil>
      <DrawCityBoxItems priority="Box"/>
    </Commands>
  </Pass>
</Passes>
</Root>
